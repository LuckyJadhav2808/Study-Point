<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Study Planner | Notion-Style</title>
    <!-- Quill.js for rich text editor -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- jsPDF for PDF export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <!-- Chart.js for progress charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="icon" type="image/png" href="icon2_192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="icon2_512x512.png" sizes="512x512">

    <link rel="apple-touch-icon" href="icon2_180x180.png">
    <style>
        :root {
            --primary: #37352f;
            --secondary: #f7f6f3;
            --accent: #4285f4;
            --sidebar: #2d2d2d;
            --card: #ffffff;
            --text: #333333;
            --text-light: #787774;
            --hover: #f0f0f0;
            --border: #e6e6e6;
            --success: #4caf50;
            --warning: #ff9800;
            --danger: #f44336;
            --subject-math: #4285f4;
            --subject-science: #34a853;
            --subject-english: #fbbc04;
            --subject-history: #ea4335;
            --subject-other: #9b59b6;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            display: flex;
            background-color: var(--secondary);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Sidebar */
        .sidebar {
            width: 250px;
            background-color: var(--sidebar);
            color: white;
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            padding: 20px 0;
            transition: transform 0.3s ease;
            z-index: 1000;
            overflow-y: auto;
        }

        .logo {
            text-align: center;
            padding: 0 20px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 20px;
        }

        .logo h1 {
            font-size: 24px;
            font-weight: 700;
            color: white;
        }

        .logo span {
            color: var(--accent);
        }

        .nav-item {
            padding: 12px 20px;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: background-color 0.2s;
            margin: 5px 10px;
            border-radius: 5px;
        }

        .nav-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .nav-item.active {
            background-color: var(--accent);
        }

        .nav-item i {
            margin-right: 10px;
            font-size: 18px;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 250px;
            padding: 20px;
            transition: margin-left 0.3s ease;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }

        .header h2 {
            font-size: 24px;
            font-weight: 600;
        }

        .user-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .btn {
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background-color: var(--accent);
            color: white;
        }

        .btn-primary:hover {
            background-color: #3367d6;
        }

        .btn-danger {
            background-color: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background-color: #d32f2f;
        }

        /* Dashboard */
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background-color: var(--card);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border);
        }

        .card-header h3 {
            font-size: 18px;
            font-weight: 600;
        }

        .stat {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
            padding: 8px 0;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
        }

        .stat-label {
            color: var(--text-light);
            font-size: 14px;
        }

        .progress-bar {
            height: 8px;
            background-color: #e9e9e9;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background-color: var(--accent);
            border-radius: 4px;
        }

        /* Notes Section */
        .notes-container {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 20px;
        }

        .notes-list {
            background-color: var(--card);
            border-radius: 10px;
            padding: 15px;
            height: 600px;
            overflow-y: auto;
        }

        .note-item {
            padding: 12px;
            border-radius: 5px;
            margin-bottom: 10px;
            cursor: pointer;
            border-left: 3px solid var(--accent);
            background-color: #f9f9f9;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .note-item:hover {
            background-color: var(--hover);
        }

        .note-item.active {
            background-color: #e6eeff;
        }

        .note-content {
            flex: 1;
        }

        .note-title {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .note-preview {
            font-size: 12px;
            color: var(--text-light);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .note-actions {
            display: flex;
            gap: 8px;
        }

        .note-actions button {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 14px;
            color: var(--text-light);
        }

        .note-actions button:hover {
            color: var(--danger);
        }

        .notes-editor {
            background-color: var(--card);
            border-radius: 10px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            height: 600px;
        }

        .editor-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .editor-actions {
            display: flex;
            gap: 10px;
        }

        #editor {
            flex: 1;
            border: 1px solid var(--border);
            border-radius: 5px;
            padding: 15px;
            overflow-y: auto;
        }

        /* Calendar */
        .calendar {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 20px;
        }

        .calendar-sidebar {
            background-color: var(--card);
            border-radius: 10px;
            padding: 20px;
        }

        .calendar-main {
            background-color: var(--card);
            border-radius: 10px;
            padding: 20px;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
        }

        .calendar-day {
            height: 100px;
            border: 1px solid var(--border);
            border-radius: 5px;
            padding: 10px;
            position: relative;
        }

        .calendar-day.active {
            background-color: #e6eeff;
            border-color: var(--accent);
        }

        .day-header {
            text-align: center;
            font-weight: 600;
            margin-bottom: 5px;
            padding-bottom: 5px;
            border-bottom: 1px solid var(--border);
        }

        /* Mobile Nav Toggle */
        .mobile-toggle {
            display: none;
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1100;
            background-color: var(--accent);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        /* Responsive Design */
        @media (max-width: 992px) {
            .sidebar {
                transform: translateX(-100%);
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .mobile-toggle {
                display: flex;
            }
            
            .notes-container {
                grid-template-columns: 1fr;
            }
            
            .notes-list {
                height: 200px;
            }
            
            .calendar {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .user-actions {
                width: 100%;
                justify-content: space-between;
            }
        }

        /* Section visibility */
        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background-color: white;
            border-left: 4px solid var(--success);
            border-radius: 4px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            transform: translateX(100%);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .notification.show {
            transform: translateX(0);
            opacity: 1;
        }

        .notification.error {
            border-left-color: var(--danger);
        }

        .notification.warning {
            border-left-color: var(--warning);
        }

        .notification.info {
            border-left-color: var(--accent);
        }

        /* Pomodoro Timer */
        .pomodoro-container {
            text-align: center;
            max-width: 400px;
            margin: 0 auto;
        }

        .timer-circle {
            width: 250px;
            height: 250px;
            border-radius: 50%;
            background: conic-gradient(var(--accent) 0%, #e6e6e6 0%);
            margin: 20px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .timer-display {
            font-size: 48px;
            font-weight: 700;
        }

        .timer-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }

        /* Task Manager */
        .task-input {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .task-input input {
            flex: 1;
            padding: 10px 15px;
            border: 1px solid var(--border);
            border-radius: 5px;
        }

        .task-list {
            list-style: none;
        }

        .task-item {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            border-bottom: 1px solid var(--border);
        }

        .task-item:last-child {
            border-bottom: none;
        }

        .task-checkbox {
            margin-right: 15px;
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .task-text {
            flex: 1;
        }

        .task-completed .task-text {
            text-decoration: line-through;
            color: var(--text-light);
        }

        .task-actions {
            display: flex;
            gap: 8px;
        }

        .task-actions button {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 14px;
            color: var(--text-light);
        }

        .task-actions button:hover {
            color: var(--danger);
        }

        /* Timetable */
        .timetable {
            width: 100%;
            border-collapse: collapse;
        }

        .timetable th, .timetable td {
            border: 1px solid var(--border);
            padding: 10px;
            text-align: center;
        }

        .timetable th {
            background-color: #f5f5f5;
            font-weight: 600;
        }

        .timetable td {
            height: 60px;
            vertical-align: top;
            cursor: pointer;
        }

        .timetable td:hover {
            background-color: #f9f9f9;
        }

        .timetable-subject {
            font-size: 12px;
            padding: 4px;
            border-radius: 3px;
            margin-bottom: 2px;
            display: block;
            color: white;
        }

        /* Backup Section */
        .backup-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .backup-option {
            text-align: center;
            padding: 30px 20px;
            background-color: var(--card);
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            cursor: pointer;
            transition: transform 0.2s;
        }

        .backup-option:hover {
            transform: translateY(-5px);
        }

        .backup-option i {
            font-size: 40px;
            color: var(--accent);
            margin-bottom: 15px;
        }

        .backup-option h3 {
            margin-bottom: 10px;
        }

        .backup-option p {
            color: var(--text-light);
            font-size: 14px;
        }

        /* Subject Manager */
        .subject-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
        }

        .subject-card {
            background-color: var(--card);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            position: relative;
        }

        .subject-color {
            width: 100%;
            height: 80px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .subject-actions {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 10px;
        }

        .subject-actions button {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 14px;
        }

        /* Resources Section */
        .resources-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }

        .resource-card {
            background-color: var(--card);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            position: relative;
        }

        .resource-icon {
            font-size: 40px;
            color: var(--accent);
            margin-bottom: 15px;
        }

        .resource-actions {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 10px;
        }

        /* Progress Section */
        .progress-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .progress-chart {
            background-color: var(--card);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background-color: white;
            border-radius: 10px;
            padding: 25px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }

        .modal-header h3 {
            font-size: 20px;
            font-weight: 600;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border);
            border-radius: 5px;
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }

        /* Event item */
        .event-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .event-actions {
            display: flex;
            gap: 8px;
        }

        .event-actions button {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 14px;
            color: var(--text-light);
        }

        .event-actions button:hover {
            color: var(--danger);
        }
    </style>
</head>
<body>
    <!-- Mobile Nav Toggle -->
    <div class="mobile-toggle">
        <i class="fas fa-bars"></i>
    </div>

    <!-- Sidebar -->
    <div class="sidebar">
        <div class="logo">
            <h1>Study<span>Planner</span></h1>
        </div>
        <div class="nav-item active" data-section="dashboard">
            <i class="fas fa-th-large"></i>
            <span>Dashboard</span>
        </div>
        <div class="nav-item" data-section="calendar">
            <i class="fas fa-calendar-alt"></i>
            <span>Calendar</span>
        </div>
        <div class="nav-item" data-section="tasks">
            <i class="fas fa-tasks"></i>
            <span>Tasks</span>
        </div>
        <div class="nav-item" data-section="pomodoro">
            <i class="fas fa-clock"></i>
            <span>Pomodoro</span>
        </div>
        <div class="nav-item" data-section="notes">
            <i class="fas fa-sticky-note"></i>
            <span>Notes</span>
        </div>
        <div class="nav-item" data-section="timetable">
            <i class="fas fa-table"></i>
            <span>Timetable</span>
        </div>
        <div class="nav-item" data-section="subjects">
            <i class="fas fa-book"></i>
            <span>Subjects</span>
        </div>
        <div class="nav-item" data-section="resources">
            <i class="fas fa-file-pdf"></i>
            <span>Resources</span>
        </div>
        <div class="nav-item" data-section="progress">
            <i class="fas fa-chart-line"></i>
            <span>Progress</span>
        </div>
        <div class="nav-item" data-section="backup">
            <i class="fas fa-cloud-upload-alt"></i>
            <span>Backup & Restore</span>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Header -->
        <div class="header">
            <h2 id="current-section">Dashboard</h2>
            <div class="user-actions">
                <button class="btn btn-primary" id="add-new">
                    <i class="fas fa-plus"></i>
                    <span>New</span>
                </button>
                <button class="btn btn-primary" id="save-data">
                    <i class="fas fa-save"></i>
                    <span>Save</span>
                </button>
                <button class="btn btn-primary" id="settings-btn">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </button>
            </div>
        </div>

        <!-- Dashboard Section -->
        <div class="section active" id="dashboard">
            <div class="dashboard">
                <div class="card">
                    <div class="card-header">
                        <h3>Study Progress</h3>
                        <i class="fas fa-chart-pie"></i>
                    </div>
                    <div class="stat">
                        <div class="stat-label">Completed Tasks</div>
                        <div class="stat-value" id="completed-tasks">0</div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">Weekly Goal</div>
                        <div class="stat-value">70%</div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>Upcoming Tasks</h3>
                        <i class="fas fa-list"></i>
                    </div>
                    <div id="upcoming-tasks">
                        <p>No upcoming tasks</p>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>Pomodoro Stats</h3>
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="stat">
                        <div class="stat-label">Sessions Completed</div>
                        <div class="stat-value" id="pomodoro-sessions">0</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">Total Focus Time</div>
                        <div class="stat-value" id="total-focus-time">0h 0m</div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>Recent Notes</h3>
                        <i class="fas fa-sticky-note"></i>
                    </div>
                    <div id="recent-notes">
                        <p>No recent notes</p>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>Today's Schedule</h3>
                        <i class="fas fa-calendar-day"></i>
                    </div>
                    <div id="today-schedule">
                        <p>No classes today</p>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>Motivation</h3>
                        <i class="fas fa-quote-left"></i>
                    </div>
                    <div id="motivation-quote">
                        <p>"The secret of getting ahead is getting started." - Mark Twain</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notes Section -->
        <div class="section" id="notes">
            <div class="notes-container">
                <div class="notes-list">
                    <div class="note-item active" data-id="1">
                        <div class="note-content">
                            <div class="note-title">Welcome Note</div>
                            <div class="note-preview">Welcome to your study planner! Start by creating a new note...</div>
                        </div>
                        <div class="note-actions">
                            <button class="delete-note" data-id="1"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>
                </div>
                <div class="notes-editor">
                    <div class="editor-header">
                        <input type="text" placeholder="Note Title" id="note-title" value="Welcome Note">
                        <div class="editor-actions">
                            <button class="btn btn-primary" id="save-note">
                                <i class="fas fa-save"></i>
                            </button>
                            <button class="btn btn-primary" id="export-pdf">
                                <i class="fas fa-file-pdf"></i>
                            </button>
                            <button class="btn btn-primary" id="new-note">
                                <i class="fas fa-plus"></i>
                            </button>
                            <button class="btn btn-danger" id="delete-note-btn">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    <div id="editor">
                        <p>Welcome to your study planner! This is a rich text editor where you can create detailed notes for your studies.</p>
                        <p>You can format your text with <strong>bold</strong>, <em>italic</em>, <u>underline</u>, and more.</p>
                        <p>Create lists:</p>
                        <ul>
                            <li>Study materials</li>
                            <li>Important points</li>
                            <li>References</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Calendar Section -->
        <div class="section" id="calendar">
            <div class="calendar">
                <div class="calendar-sidebar">
                    <h3>Event Planner</h3>
                    <div id="event-form">
                        <div class="form-group">
                            <label>Event Title</label>
                            <input type="text" id="event-title" placeholder="Enter event title">
                        </div>
                        <div class="form-group">
                            <label>Date</label>
                            <input type="date" id="event-date">
                        </div>
                        <div class="form-group">
                            <label>Description</label>
                            <textarea id="event-description" placeholder="Event description" rows="3"></textarea>
                        </div>
                        <button class="btn btn-primary" id="add-event">Add Event</button>
                    </div>
                    <div id="event-list" style="margin-top: 20px;">
                        <h4>Upcoming Events</h4>
                    </div>
                </div>
                <div class="calendar-main">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 id="calendar-month">October 2023</h3>
                        <div>
                            <button class="btn btn-primary" id="prev-month"><i class="fas fa-chevron-left"></i></button>
                            <button class="btn btn-primary" id="next-month"><i class="fas fa-chevron-right"></i></button>
                        </div>
                    </div>
                    <div class="calendar-grid">
                        <div class="day-header">Sun</div>
                        <div class="day-header">Mon</div>
                        <div class="day-header">Tue</div>
                        <div class="day-header">Wed</div>
                        <div class="day-header">Thu</div>
                        <div class="day-header">Fri</div>
                        <div class="day-header">Sat</div>
                        <!-- Calendar days will be generated here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Tasks Section -->
        <div class="section" id="tasks">
            <h2>Task Manager</h2>
            <div class="task-input">
                <input type="text" id="task-input" placeholder="Add a new task...">
                <button class="btn btn-primary" id="add-task">Add Task</button>
            </div>
            <ul class="task-list" id="task-list">
                <!-- Tasks will be added here -->
            </ul>
        </div>

        <!-- Pomodoro Section -->
        <div class="section" id="pomodoro">
            <div class="pomodoro-container">
                <h2>Pomodoro Timer</h2>
                <div class="timer-circle" id="timer-circle">
                    <div class="timer-display" id="timer-display">25:00</div>
                </div>
                <div class="timer-controls">
                    <button class="btn btn-primary" id="start-timer">Start</button>
                    <button class="btn btn-primary" id="pause-timer">Pause</button>
                    <button class="btn btn-primary" id="reset-timer">Reset</button>
                </div>
                <div style="margin-top: 20px;">
                    <h3>Settings</h3>
                    <div style="display: flex; gap: 15px; justify-content: center; margin-top: 10px;">
                        <div>
                            <label>Study Time</label>
                            <input type="number" id="study-time" value="25" min="1" style="width: 60px; padding: 5px;">
                        </div>
                        <div>
                            <label>Break Time</label>
                            <input type="number" id="break-time" value="5" min="1" style="width: 60px; padding: 5px;">
                        </div>
                    </div>
                </div>
                <div style="margin-top: 20px;">
                    <h3>Session History</h3>
                    <div id="session-history">
                        <!-- Session history will be added here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Timetable Section -->
        <div class="section" id="timetable">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2>Timetable</h2>
                <button class="btn btn-primary" id="save-timetable">Save Timetable</button>
            </div>
            <table class="timetable" id="timetable-grid">
                <thead>
                    <tr>
                        <th>Time/Day</th>
                        <th>Monday</th>
                        <th>Tuesday</th>
                        <th>Wednesday</th>
                        <th>Thursday</th>
                        <th>Friday</th>
                        <th>Saturday</th>
                        <th>Sunday</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Timetable will be generated here -->
                </tbody>
            </table>
        </div>

        <!-- Subjects Section -->
        <div class="section" id="subjects">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2>Subjects</h2>
                <button class="btn btn-primary" id="add-subject">Add Subject</button>
            </div>
            <div class="subject-grid" id="subject-grid">
                <!-- Subject cards will be added here -->
            </div>
        </div>

        <!-- Resources Section -->
        <div class="section" id="resources">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2>Resources</h2>
                <button class="btn btn-primary" id="add-resource">Add Resource</button>
            </div>
            <div class="resources-grid" id="resources-grid">
                <!-- Resource cards will be added here -->
            </div>
        </div>

        <!-- Progress Section -->
        <div class="section" id="progress">
            <h2>Progress Tracking</h2>
            <div class="progress-container">
                <div class="progress-chart">
                    <h3>Study Progress</h3>
                    <canvas id="progress-chart" width="400" height="300"></canvas>
                </div>
                <div class="progress-chart">
                    <h3>Subject-wise Progress</h3>
                    <canvas id="subject-chart" width="400" height="300"></canvas>
                </div>
            </div>
            <div class="card" style="margin-top: 20px;">
                <div class="card-header">
                    <h3>Study Statistics</h3>
                </div>
                <div id="study-statistics">
                    <!-- Statistics will be added here -->
                </div>
            </div>
        </div>

        <!-- Backup Section -->
        <div class="section" id="backup">
            <h2>Backup & Restore</h2>
            <p>Keep your data safe by creating backups or restoring from previous backups.</p>
            
            <div class="backup-options">
                <div class="backup-option" id="create-backup">
                    <i class="fas fa-download"></i>
                    <h3>Create Backup</h3>
                    <p>Download a backup of all your data</p>
                </div>
                <div class="backup-option" id="restore-backup">
                    <i class="fas fa-upload"></i>
                    <h3>Restore Backup</h3>
                    <p>Upload a previous backup file</p>
                </div>
                <div class="backup-option" id="cloud-sync">
                    <i class="fas fa-cloud"></i>
                    <h3>Cloud Sync</h3>
                    <p>Sync your data with cloud storage</p>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h3>Recent Backups</h3>
                </div>
                <div id="backup-list">
                    <p>No backups found</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification">
        Your data has been saved successfully!
    </div>

    <!-- Add Subject Modal -->
    <div class="modal" id="subject-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">Add New Subject</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="form-group">
                <label>Subject Name</label>
                <input type="text" id="subject-name" placeholder="Enter subject name">
            </div>
            <div class="form-group">
                <label>Subject Color</label>
                <input type="color" id="subject-color" value="#4285f4">
            </div>
            <div class="form-group">
                <label>Teacher Name</label>
                <input type="text" id="subject-teacher" placeholder="Enter teacher name">
            </div>
            <div class="form-group">
                <label>Room Number</label>
                <input type="text" id="subject-room" placeholder="Enter room number">
            </div>
            <div class="form-actions">
                <button class="btn btn-primary" id="save-subject">Save Subject</button>
                <button class="btn btn-primary" id="cancel-subject">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Add Resource Modal -->
    <div class="modal" id="resource-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="resource-modal-title">Add New Resource</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="form-group">
                <label>Resource Type</label>
                <select id="resource-type">
                    <option value="pdf">PDF</option>
                    <option value="link">Web Link</option>
                    <option value="document">Document</option>
                    <option value="other">Other</option>
                </select>
            </div>
            <div class="form-group">
                <label>Resource Title</label>
                <input type="text" id="resource-title" placeholder="Enter resource title">
            </div>
            <div class="form-group" id="resource-url-group">
                <label>Resource URL/Path</label>
                <input type="text" id="resource-url" placeholder="Enter URL or file path">
            </div>
            <div class="form-group" id="resource-file-group" style="display: none;">
                <label>Upload File</label>
                <input type="file" id="resource-file">
            </div>
            <div class="form-group">
                <label>Description</label>
                <textarea id="resource-description" placeholder="Enter resource description" rows="3"></textarea>
            </div>
            <div class="form-group">
                <label>Subject</label>
                <select id="resource-subject">
                    <option value="">No Subject</option>
                </select>
            </div>
            <div class="form-actions">
                <button class="btn btn-primary" id="save-resource">Save Resource</button>
                <button class="btn btn-primary" id="cancel-resource">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal" id="settings-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Settings</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="form-group">
                <label>Study Goal (hours per week)</label>
                <input type="number" id="study-goal" value="20" min="1" max="40">
            </div>
            <div class="form-group">
                <label>Default Pomodoro Time (minutes)</label>
                <input type="number" id="pomodoro-default" value="25" min="5" max="60">
            </div>
            <div class="form-group">
                <label>Default Break Time (minutes)</label>
                <input type="number" id="break-default" value="5" min="1" max="30">
            </div>
            <div class="form-group">
                <label>Enable Notifications</label>
                <input type="checkbox" id="enable-notifications" checked>
            </div>
            <div class="form-actions">
                <button class="btn btn-primary" id="save-settings">Save Settings</button>
                <button class="btn btn-primary" id="cancel-settings">Cancel</button>
            </div>
        </div>
    </div>

    <!-- File Input for Backup -->
    <input type="file" id="backup-file" style="display: none;" accept=".json">

    <!-- Quill.js -->
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <script>
        // Initialize Quill editor
        var quill = new Quill('#editor', {
            theme: 'snow',
            modules: {
                toolbar: [
                    [{ 'header': [1, 2, 3, 4, 5, 6, false] }],
                    ['bold', 'italic', 'underline', 'strike'],
                    [{ 'color': [] }, { 'background': [] }],
                    [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                    ['link', 'image'],
                    ['clean']
                ]
            }
        });

        // Initialize app functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize data
            initApp();
            
            // Mobile sidebar toggle
            const mobileToggle = document.querySelector('.mobile-toggle');
            const sidebar = document.querySelector('.sidebar');
            
            mobileToggle.addEventListener('click', function() {
                sidebar.classList.toggle('active');
            });
            
            // Navigation
            const navItems = document.querySelectorAll('.nav-item');
            const sections = document.querySelectorAll('.section');
            const currentSection = document.getElementById('current-section');
            
            navItems.forEach(item => {
                item.addEventListener('click', function() {
                    const sectionId = this.getAttribute('data-section');
                    
                    // Update active nav item
                    navItems.forEach(nav => nav.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Show corresponding section
                    sections.forEach(section => section.classList.remove('active'));
                    document.getElementById(sectionId).classList.add('active');
                    
                    // Update header title
                    currentSection.textContent = this.querySelector('span').textContent;
                    
                    // On mobile, hide sidebar after selection
                    if (window.innerWidth < 992) {
                        sidebar.classList.remove('active');
                    }
                });
            });
            
            // Header buttons functionality
            document.getElementById('add-new').addEventListener('click', function() {
                const activeSection = document.querySelector('.section.active').id;
                
                switch(activeSection) {
                    case 'notes':
                        createNewNote();
                        break;
                    case 'tasks':
                        document.getElementById('task-input').focus();
                        break;
                    case 'calendar':
                        document.getElementById('event-title').focus();
                        // Auto-fill today's date
                        const today = new Date().toISOString().split('T')[0];
                        document.getElementById('event-date').value = today;
                        break;
                    case 'subjects':
                        openSubjectEditor();
                        break;
                    case 'resources':
                        openResourceEditor();
                        break;
                    case 'dashboard':
                        // Create a new note from dashboard
                        createNewNote();
                        // Switch to notes section
                        document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
                        document.querySelector('.nav-item[data-section="notes"]').classList.add('active');
                        document.querySelectorAll('.section').forEach(section => section.classList.remove('active'));
                        document.getElementById('notes').classList.add('active');
                        document.getElementById('current-section').textContent = 'Notes';
                        break;
                    default:
                        showNotification('Use the section-specific add button', 'info');
                }
            });
            
            document.getElementById('save-data').addEventListener('click', function() {
                saveAllData();
                showNotification('Your data has been saved successfully!');
            });
            
            document.getElementById('settings-btn').addEventListener('click', function() {
                openSettings();
            });
            
            // Initialize all components
            initNotes();
            initCalendar();
            initTasks();
            initPomodoro();
            initTimetable();
            initSubjects();
            initResources();
            initProgress();
            initBackup();
        });

        // Initialize the app with default data
        function initApp() {
            // Check if data exists in localStorage
            if (!localStorage.getItem('studyPlannerData')) {
                // Create default data structure
                const defaultData = {
                    notes: [
                        {
                            id: 1,
                            title: "Welcome Note",
                            content: "<p>Welcome to your study planner! This is a rich text editor where you can create detailed notes for your studies.</p><p>You can format your text with <strong>bold</strong>, <em>italic</em>, <u>underline</u>, and more.</p><p>Create lists:</p><ul><li>Study materials</li><li>Important points</li><li>References</li></ul>",
                            createdAt: new Date().toISOString(),
                            updatedAt: new Date().toISOString()
                        }
                    ],
                    tasks: [],
                    events: [],
                    pomodoro: {
                        sessions: 0,
                        totalTime: 0
                    },
                    timetable: {},
                    subjects: [],
                    resources: [],
                    settings: {
                        studyGoal: 20,
                        pomodoroTime: 25,
                        breakTime: 5,
                        notifications: true
                    },
                    progress: {
                        studyHours: [],
                        subjectProgress: {}
                    },
                    currentNoteId: 1
                };
                
                // Save default data to localStorage
                localStorage.setItem('studyPlannerData', JSON.stringify(defaultData));
            }
            
            // Load data and update UI
            loadData();
        }

        // Load data from localStorage
        function loadData() {
            const data = JSON.parse(localStorage.getItem('studyPlannerData'));
            
            // Update dashboard stats
            updateDashboard(data);
        }

        // Save all data to localStorage
        function saveAllData() {
            const data = JSON.parse(localStorage.getItem('studyPlannerData'));
            
            // Update with current state
            // This would be expanded to save all data from various components
            
            localStorage.setItem('studyPlannerData', JSON.stringify(data));
        }

        // Update dashboard with current data
        function updateDashboard(data) {
            // Update completed tasks count
            const completedTasks = data.tasks.filter(task => task.completed).length;
            document.getElementById('completed-tasks').textContent = completedTasks;
            
            // Update progress bar
            const progressFill = document.getElementById('progress-fill');
            const progressPercent = data.tasks.length > 0 ? 
                (completedTasks / data.tasks.length) * 100 : 0;
            progressFill.style.width = `${progressPercent}%`;
            
            // Update pomodoro stats
            document.getElementById('pomodoro-sessions').textContent = data.pomodoro.sessions;
            
            // Format total focus time
            const hours = Math.floor(data.pomodoro.totalTime / 60);
            const minutes = data.pomodoro.totalTime % 60;
            document.getElementById('total-focus-time').textContent = `${hours}h ${minutes}m`;
            
            // Update upcoming tasks
            const upcomingTasks = document.getElementById('upcoming-tasks');
            if (data.tasks.length > 0) {
                upcomingTasks.innerHTML = '';
                data.tasks.slice(0, 3).forEach(task => {
                    const taskEl = document.createElement('div');
                    taskEl.style.padding = '10px';
                    taskEl.style.borderBottom = '1px solid #eee';
                    taskEl.innerHTML = `
                        <div style="font-weight: bold;">${task.text}</div>
                        <div style="font-size: 12px; color: #666;">${task.dueDate ? 'Due: ' + task.dueDate : ''}</div>
                    `;
                    upcomingTasks.appendChild(taskEl);
                });
            } else {
                upcomingTasks.innerHTML = '<p>No upcoming tasks</p>';
            }
            
            // Update recent notes
            const recentNotes = document.getElementById('recent-notes');
            if (data.notes.length > 0) {
                recentNotes.innerHTML = '';
                data.notes.slice(0, 3).forEach(note => {
                    const noteEl = document.createElement('div');
                    noteEl.style.padding = '10px';
                    noteEl.style.borderBottom = '1px solid #eee';
                    noteEl.innerHTML = `
                        <div style="font-weight: bold;">${note.title}</div>
                        <div style="font-size: 12px; color: #666;">Updated: ${new Date(note.updatedAt).toLocaleDateString()}</div>
                    `;
                    recentNotes.appendChild(noteEl);
                });
            } else {
                recentNotes.innerHTML = '<p>No recent notes</p>';
            }
        }

        // Show notification
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = 'notification';
            notification.classList.add(type);
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Open settings modal
        function openSettings() {
            const data = JSON.parse(localStorage.getItem('studyPlannerData'));
            const settingsModal = document.getElementById('settings-modal');
            
            // Populate settings
            document.getElementById('study-goal').value = data.settings.studyGoal;
            document.getElementById('pomodoro-default').value = data.settings.pomodoroTime;
            document.getElementById('break-default').value = data.settings.breakTime;
            document.getElementById('enable-notifications').checked = data.settings.notifications;
            
            // Show modal
            settingsModal.classList.add('active');
            
            // Set up event listeners
            document.getElementById('save-settings').addEventListener('click', function() {
                data.settings.studyGoal = parseInt(document.getElementById('study-goal').value);
                data.settings.pomodoroTime = parseInt(document.getElementById('pomodoro-default').value);
                data.settings.breakTime = parseInt(document.getElementById('break-default').value);
                data.settings.notifications = document.getElementById('enable-notifications').checked;
                
                localStorage.setItem('studyPlannerData', JSON.stringify(data));
                settingsModal.classList.remove('active');
                showNotification('Settings saved successfully!');
            });
            
            document.getElementById('cancel-settings').addEventListener('click', function() {
                settingsModal.classList.remove('active');
            });
            
            document.querySelector('#settings-modal .close-modal').addEventListener('click', function() {
                settingsModal.classList.remove('active');
            });
        }

        // Initialize Notes functionality
        function initNotes() {
            const data = JSON.parse(localStorage.getItem('studyPlannerData'));
            const notesList = document.querySelector('.notes-list');
            const noteTitle = document.getElementById('note-title');
            const saveNoteBtn = document.getElementById('save-note');
            const newNoteBtn = document.getElementById('new-note');
            const exportPdfBtn = document.getElementById('export-pdf');
            const deleteNoteBtn = document.getElementById('delete-note-btn');
            
            // Load notes into the list
            function loadNotes() {
                notesList.innerHTML = '';
                
                data.notes.forEach(note => {
                    const noteItem = document.createElement('div');
                    noteItem.className = 'note-item';
                    if (note.id === data.currentNoteId) {
                        noteItem.classList.add('active');
                    }
                    noteItem.setAttribute('data-id', note.id);
                    
                    noteItem.innerHTML = `
                        <div class="note-content">
                            <div class="note-title">${note.title}</div>
                            <div class="note-preview">${note.content.replace(/<[^>]*>/g, '').substring(0, 50)}...</div>
                        </div>
                        <div class="note-actions">
                            <button class="delete-note" data-id="${note.id}"><i class="fas fa-trash"></i></button>
                        </div>
                    `;
                    
                    noteItem.addEventListener('click', function(e) {
                        if (!e.target.closest('.note-actions')) {
                            document.querySelectorAll('.note-item').forEach(item => {
                                item.classList.remove('active');
                            });
                            this.classList.add('active');
                            
                            loadNote(note.id);
                        }
                    });
                    
                    // Add delete event listener
                    const deleteBtn = noteItem.querySelector('.delete-note');
                    deleteBtn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        deleteNote(note.id);
                    });
                    
                    notesList.appendChild(noteItem);
                });
            }
            
            // Load a specific note into the editor
            function loadNote(noteId) {
                const note = data.notes.find(n => n.id === noteId);
                if (note) {
                    noteTitle.value = note.title;
                    quill.root.innerHTML = note.content;
                    data.currentNoteId = noteId;
                    localStorage.setItem('studyPlannerData', JSON.stringify(data));
                }
            }
            
            // Save the current note
            function saveCurrentNote() {
                const noteId = data.currentNoteId;
                const noteIndex = data.notes.findIndex(n => n.id === noteId);
                
                if (noteIndex !== -1) {
                    data.notes[noteIndex].title = noteTitle.value;
                    data.notes[noteIndex].content = quill.root.innerHTML;
                    data.notes[noteIndex].updatedAt = new Date().toISOString();
                    
                    localStorage.setItem('studyPlannerData', JSON.stringify(data));
                    loadNotes();
                    showNotification('Note saved successfully!');
                }
            }
            
            // Create a new note
            function createNewNote() {
                const newId = data.notes.length > 0 ? Math.max(...data.notes.map(n => n.id)) + 1 : 1;
                
                const newNote = {
                    id: newId,
                    title: 'New Note',
                    content: '<p>Start writing your note here...</p>',
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                
                data.notes.push(newNote);
                data.currentNoteId = newId;
                
                localStorage.setItem('studyPlannerData', JSON.stringify(data));
                loadNotes();
                loadNote(newId);
                
                showNotification('New note created!');
            }
            
            // Delete a note
            function deleteNote(noteId) {
                if (data.notes.length <= 1) {
                    showNotification('You need to have at least one note', 'error');
                    return;
                }
                
                if (confirm('Are you sure you want to delete this note?')) {
                    const noteIndex = data.notes.findIndex(n => n.id === noteId);
                    
                    if (noteIndex !== -1) {
                        data.notes.splice(noteIndex, 1);
                        
                        // If we deleted the current note, switch to the first note
                        if (data.currentNoteId === noteId) {
                            data.currentNoteId = data.notes[0].id;
                        }
                        
                        localStorage.setItem('studyPlannerData', JSON.stringify(data));
                        loadNotes();
                        
                        if (data.currentNoteId) {
                            loadNote(data.currentNoteId);
                        }
                        
                        showNotification('Note deleted successfully!');
                    }
                }
            }
            
            // Export note as PDF
            // Export note as high-resolution PDF with exact formatting using html2canvas
// Export note as high-resolution PDF with exact formatting using html2canvas
function exportNoteAsPdf() {
    const noteTitleText = noteTitle.value;
    
    // Show loading notification
    showNotification('Generating high-resolution PDF...', 'info');
    
    // Create a temporary container for the note content
    const tempContainer = document.createElement('div');
    tempContainer.id = 'pdf-export-container'; // Add ID for reference
    tempContainer.style.width = '210mm';
    tempContainer.style.padding = '25px';
    tempContainer.style.fontFamily = 'Segoe UI, Tahoma, Geneva, Verdana, sans-serif';
    tempContainer.style.backgroundColor = 'white';
    tempContainer.style.color = '#333333';
    tempContainer.style.lineHeight = '1.6';
    tempContainer.style.boxSizing = 'border-box';
    
    // Add title
    const titleElement = document.createElement('h1');
    titleElement.textContent = noteTitleText;
    titleElement.style.textAlign = 'center';
    titleElement.style.marginBottom = '25px';
    titleElement.style.fontSize = '28px';
    titleElement.style.color = '#4285f4';
    titleElement.style.borderBottom = '2px solid #4285f4';
    titleElement.style.paddingBottom = '10px';
    tempContainer.appendChild(titleElement);
    
    // Add content - clone the editor content to preserve styles
    const contentElement = document.createElement('div');
    contentElement.innerHTML = quill.root.innerHTML;
    
    // Preserve Quill formatting styles
    contentElement.querySelectorAll('.ql-size-small').forEach(el => {
        el.style.fontSize = '12px';
    });
    contentElement.querySelectorAll('.ql-size-large').forEach(el => {
        el.style.fontSize = '24px';
    });
    contentElement.querySelectorAll('.ql-size-huge').forEach(el => {
        el.style.fontSize = '32px';
    });
    contentElement.querySelectorAll('strong, b').forEach(el => {
        el.style.fontWeight = 'bold';
    });
    contentElement.querySelectorAll('em, i').forEach(el => {
        el.style.fontStyle = 'italic';
    });
    contentElement.querySelectorAll('u').forEach(el => {
        el.style.textDecoration = 'underline';
    });
    
    tempContainer.appendChild(contentElement);
    
    // Add to document temporarily
    tempContainer.style.position = 'fixed';
    tempContainer.style.left = '-9999px';
    tempContainer.style.top = '0';
    document.body.appendChild(tempContainer);
    
    // Use html2canvas with high DPI settings for better resolution
    const options = {
        scale: 3, // Higher scale for better resolution
        useCORS: true,
        allowTaint: true,
        backgroundColor: '#ffffff',
        logging: false,
        onclone: function(clonedDoc) {
            // Ensure styles are preserved in the clone
            const clonedContainer = clonedDoc.getElementById('pdf-export-container');
            if (clonedContainer) {
                clonedContainer.style.width = '210mm';
                clonedContainer.style.padding = '25px';
                clonedContainer.style.fontFamily = 'Segoe UI, Tahoma, Geneva, Verdana, sans-serif';
                clonedContainer.style.backgroundColor = 'white';
                clonedContainer.style.color = '#333333';
                clonedContainer.style.lineHeight = '1.6';
            }
        }
    };
    
    // Generate the PDF
    html2canvas(tempContainer, options).then(canvas => {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF('p', 'mm', 'a4');
        
        // Calculate dimensions
        const imgWidth = 210; // A4 width in mm
        const imgHeight = (canvas.height * imgWidth) / canvas.width;
        
        // Add image to PDF
        const imgData = canvas.toDataURL('image/jpeg', 1.0);
        doc.addImage(imgData, 'JPEG', 0, 0, imgWidth, imgHeight);
        
        // Add page breaks for long content
        let heightLeft = imgHeight;
        let position = 0;
        let pageCount = 1;
        
        // Add additional pages if needed
        while (heightLeft > 297) { // 297mm is A4 height
            position = heightLeft - 297;
            doc.addPage();
            doc.addImage(imgData, 'JPEG', 0, -position, imgWidth, imgHeight);
            heightLeft -= 297;
            pageCount++;
        }
        
        // Add footer with page numbers
        for (let i = 1; i <= pageCount; i++) {
            doc.setPage(i);
            doc.setFontSize(10);
            doc.setTextColor(100);
            doc.text(`Page ${i} of ${pageCount}`, 200, 285, { align: 'right' });
            doc.text('Exported from Study Planner', 10, 285);
        }
        
        // Save the PDF
        doc.save(`${noteTitleText.replace(/[^a-z0-9]/gi, '_')}.pdf`);
        
        // Clean up
        document.body.removeChild(tempContainer);
        
        showNotification('High-resolution PDF exported successfully!');
    }).catch(error => {
        console.error('Error generating PDF:', error);
        document.body.removeChild(tempContainer);
        showNotification('Error generating PDF. Please try again.', 'error');
    });
}
            
            // Set up event listeners
            saveNoteBtn.addEventListener('click', saveCurrentNote);
            newNoteBtn.addEventListener('click', createNewNote);
            exportPdfBtn.addEventListener('click', exportNoteAsPdf);
            deleteNoteBtn.addEventListener('click', function() {
                if (data.currentNoteId) {
                    deleteNote(data.currentNoteId);
                }
            });
            
            // Load notes on initialization
            loadNotes();
            if (data.currentNoteId) {
                loadNote(data.currentNoteId);
            }
        }

        // Initialize Calendar functionality
        function initCalendar() {
            const data = JSON.parse(localStorage.getItem('studyPlannerData'));
            const calendarGrid = document.querySelector('.calendar-grid');
            const calendarMonth = document.getElementById('calendar-month');
            const prevMonthBtn = document.getElementById('prev-month');
            const nextMonthBtn = document.getElementById('next-month');
            const addEventBtn = document.getElementById('add-event');
            const eventList = document.getElementById('event-list');
            
            let currentDate = new Date();
            let currentMonth = currentDate.getMonth();
            let currentYear = currentDate.getFullYear();
            
            // Generate calendar for the current month
            function generateCalendar() {
                // Clear existing days except headers
                while (calendarGrid.children.length > 7) {
                    calendarGrid.removeChild(calendarGrid.lastChild);
                }
                
                // Set month and year in header
                const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
                calendarMonth.textContent = `${monthNames[currentMonth]} ${currentYear}`;
                
                // Get first day of month and number of days
                const firstDay = new Date(currentYear, currentMonth, 1).getDay();
                const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
                
                // Create empty cells for days before the first day
                for (let i = 0; i < firstDay; i++) {
                    const emptyCell = document.createElement('div');
                    emptyCell.className = 'calendar-day';
                    calendarGrid.appendChild(emptyCell);
                }
                
                // Create cells for each day of the month
                for (let i = 1; i <= daysInMonth; i++) {
                    const dayElement = document.createElement('div');
                    dayElement.className = 'calendar-day';
                    dayElement.innerHTML = `<div class="day-number">${i}</div>`;
                    
                    // Check if there are events on this day
                    const dateStr = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;
                    const dayEvents = data.events.filter(event => event.date === dateStr);
                    
                    // Add events to the day cell
                    dayEvents.forEach(event => {
                        const eventElement = document.createElement('div');
                        eventElement.className = 'calendar-event';
                        eventElement.style.backgroundColor = '#4285f4';
                        eventElement.style.color = 'white';
                        eventElement.style.padding = '2px';
                        eventElement.style.borderRadius = '3px';
                        eventElement.style.fontSize = '12px';
                        eventElement.style.marginTop = '5px';
                        eventElement.textContent = event.title;
                        
                        dayElement.appendChild(eventElement);
                    });
                    
                    // Highlight current day
                    if (currentDate.getDate() === i && 
                        currentDate.getMonth() === currentMonth && 
                        currentDate.getFullYear() === currentYear) {
                        dayElement.classList.add('active');
                    }
                    
                    calendarGrid.appendChild(dayElement);
                }
                
                // Update event list
                updateEventList();
            }
            
            // Update the event list in the sidebar
            function updateEventList() {
                // Clear current events
                while (eventList.children.length > 1) {
                    eventList.removeChild(eventList.lastChild);
                }
                
                // Get upcoming events (next 7 days)
                const today = new Date();
                const nextWeek = new Date();
                nextWeek.setDate(today.getDate() + 7);
                
                const upcomingEvents = data.events.filter(event => {
                    const eventDate = new Date(event.date);
                    return eventDate >= today && eventDate <= nextWeek;
                }).sort((a, b) => new Date(a.date) - new Date(b.date));
                
                // Add events to the list
                if (upcomingEvents.length > 0) {
                    upcomingEvents.forEach(event => {
                        const eventItem = document.createElement('div');
                        eventItem.className = 'event-item';
                        
                        const eventDate = new Date(event.date);
                        eventItem.innerHTML = `
                            <div>
                                <div style="font-weight: bold;">${event.title}</div>
                                <div style="font-size: 12px; color: #666;">${eventDate.toLocaleDateString()}</div>
                            </div>
                            <div class="event-actions">
                                <button class="delete-event" data-id="${event.id}"><i class="fas fa-trash"></i></button>
                            </div>
                        `;
                        
                        // Add delete event listener
                        const deleteBtn = eventItem.querySelector('.delete-event');
                        deleteBtn.addEventListener('click', function() {
                            deleteEvent(event.id);
                        });
                        
                        eventList.appendChild(eventItem);
                    });
                } else {
                    const noEvents = document.createElement('div');
                    noEvents.textContent = 'No upcoming events';
                    noEvents.style.padding = '10px';
                    noEvents.style.color = '#666';
                    eventList.appendChild(noEvents);
                }
            }
            
            // Add a new event
            function addNewEvent() {
                const eventTitle = document.getElementById('event-title').value;
                const eventDate = document.getElementById('event-date').value;
                const eventDescription = document.getElementById('event-description').value;
                
                if (!eventTitle || !eventDate) {
                    showNotification('Please fill in all required fields', 'error');
                    return;
                }
                
                const newEvent = {
                    id: data.events.length > 0 ? Math.max(...data.events.map(e => e.id)) + 1 : 1,
                    title: eventTitle,
                    date: eventDate,
                    description: eventDescription
                };
                
                data.events.push(newEvent);
                localStorage.setItem('studyPlannerData', JSON.stringify(data));
                
                // Clear form
                document.getElementById('event-title').value = '';
                document.getElementById('event-date').value = '';
                document.getElementById('event-description').value = '';
                
                // Update calendar and event list
                generateCalendar();
                showNotification('Event added successfully!');
            }
            
            // Delete an event
            function deleteEvent(eventId) {
                if (confirm('Are you sure you want to delete this event?')) {
                    const eventIndex = data.events.findIndex(e => e.id === eventId);
                    
                    if (eventIndex !== -1) {
                        data.events.splice(eventIndex, 1);
                        
                        localStorage.setItem('studyPlannerData', JSON.stringify(data));
                        generateCalendar();
                        showNotification('Event deleted successfully!');
                    }
                }
            }
            
            // Set up event listeners
            prevMonthBtn.addEventListener('click', function() {
                currentMonth--;
                if (currentMonth < 0) {
                    currentMonth = 11;
                    currentYear--;
                }
                generateCalendar();
            });
            
            nextMonthBtn.addEventListener('click', function() {
                currentMonth++;
                if (currentMonth > 11) {
                    currentMonth = 0;
                    currentYear++;
                }
                generateCalendar();
            });
            
            addEventBtn.addEventListener('click', addNewEvent);
            
            // Generate initial calendar
            generateCalendar();
        }

        // Initialize Tasks functionality
        function initTasks() {
            const data = JSON.parse(localStorage.getItem('studyPlannerData'));
            const taskInput = document.getElementById('task-input');
            const addTaskBtn = document.getElementById('add-task');
            const taskList = document.getElementById('task-list');
            
            // Load tasks into the list
            function loadTasks() {
                taskList.innerHTML = '';
                
                if (data.tasks.length === 0) {
                    taskList.innerHTML = '<p>No tasks yet. Add a new task to get started!</p>';
                    return;
                }
                
                data.tasks.forEach(task => {
                    const taskItem = document.createElement('li');
                    taskItem.className = 'task-item';
                    if (task.completed) {
                        taskItem.classList.add('task-completed');
                    }
                    
                    taskItem.innerHTML = `
                        <input type="checkbox" class="task-checkbox" ${task.completed ? 'checked' : ''}>
                        <span class="task-text">${task.text}</span>
                        <div class="task-actions">
                            <button class="delete-task" data-id="${task.id}"><i class="fas fa-trash"></i></button>
                        </div>
                    `;
                    
                    const checkbox = taskItem.querySelector('.task-checkbox');
                    checkbox.addEventListener('change', function() {
                        task.completed = this.checked;
                        if (this.checked) {
                            taskItem.classList.add('task-completed');
                        } else {
                            taskItem.classList.remove('task-completed');
                        }
                        localStorage.setItem('studyPlannerData', JSON.stringify(data));
                        updateDashboard(data);
                    });
                    
                    // Add delete event listener
                    const deleteBtn = taskItem.querySelector('.delete-task');
                    deleteBtn.addEventListener('click', function() {
                        deleteTask(task.id);
                    });
                    
                    taskList.appendChild(taskItem);
                });
            }
            
            // Add a new task
            function addNewTask() {
                const taskText = taskInput.value.trim();
                
                if (!taskText) {
                    showNotification('Please enter a task', 'error');
                    return;
                }
                
                const newTask = {
                    id: data.tasks.length > 0 ? Math.max(...data.tasks.map(t => t.id)) + 1 : 1,
                    text: taskText,
                    completed: false,
                    createdAt: new Date().toISOString()
                };
                
                data.tasks.push(newTask);
                localStorage.setItem('studyPlannerData', JSON.stringify(data));
                
                // Clear input
                taskInput.value = '';
                
                // Reload tasks and update dashboard
                loadTasks();
                updateDashboard(data);
                showNotification('Task added successfully!');
            }
            
            // Delete a task
            function deleteTask(taskId) {
                if (confirm('Are you sure you want to delete this task?')) {
                    const taskIndex = data.tasks.findIndex(t => t.id === taskId);
                    
                    if (taskIndex !== -1) {
                        data.tasks.splice(taskIndex, 1);
                        
                        localStorage.setItem('studyPlannerData', JSON.stringify(data));
                        loadTasks();
                        updateDashboard(data);
                        showNotification('Task deleted successfully!');
                    }
                }
            }
            
            // Set up event listeners
            addTaskBtn.addEventListener('click', addNewTask);
            taskInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    addNewTask();
                }
            });
            
            // Load tasks on initialization
            loadTasks();
        }

        // Initialize Pomodoro Timer functionality
        function initPomodoro() {
            const data = JSON.parse(localStorage.getItem('studyPlannerData'));
            const timerDisplay = document.getElementById('timer-display');
            const timerCircle = document.getElementById('timer-circle');
            const startTimerBtn = document.getElementById('start-timer');
            const pauseTimerBtn = document.getElementById('pause-timer');
            const resetTimerBtn = document.getElementById('reset-timer');
            const studyTimeInput = document.getElementById('study-time');
            const breakTimeInput = document.getElementById('break-time');
            const sessionHistory = document.getElementById('session-history');
            
            let timer;
            let timeLeft;
            let isRunning = false;
            let isStudyTime = true;
            
            // Update timer display
            function updateTimerDisplay() {
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                // Update progress circle
                const totalTime = isStudyTime ? studyTimeInput.value * 60 : breakTimeInput.value * 60;
                const progress = ((totalTime - timeLeft) / totalTime) * 100;
                timerCircle.style.background = `conic-gradient(var(--accent) ${progress}%, #e6e6e6 ${progress}%)`;
            }
            
            // Start the timer
            function startTimer() {
                if (isRunning) return;
                
                if (!timeLeft) {
                    timeLeft = (isStudyTime ? studyTimeInput.value : breakTimeInput.value) * 60;
                }
                
                isRunning = true;
                
                timer = setInterval(() => {
                    timeLeft--;
                    updateTimerDisplay();
                    
                    if (timeLeft <= 0) {
                        clearInterval(timer);
                        isRunning = false;
                        
                        if (isStudyTime) {
                            // Study session completed
                            data.pomodoro.sessions++;
                            data.pomodoro.totalTime += parseInt(studyTimeInput.value);
                            localStorage.setItem('studyPlannerData', JSON.stringify(data));
                            updateDashboard(data);
                            
                            // Add to session history
                            addSessionHistory(`Study session completed - ${studyTimeInput.value} minutes`);
                            
                            // Switch to break time
                            isStudyTime = false;
                            timeLeft = breakTimeInput.value * 60;
                            showNotification('Study session completed! Time for a break.', 'success');
                        } else {
                            // Break completed
                            // Switch to study time
                            isStudyTime = true;
                            timeLeft = studyTimeInput.value * 60;
                            showNotification('Break completed! Ready for another study session?', 'success');
                        }
                        
                        updateTimerDisplay();
                    }
                }, 1000);
            }
            
            // Pause the timer
            function pauseTimer() {
                clearInterval(timer);
                isRunning = false;
            }
            
            // Reset the timer
            function resetTimer() {
                clearInterval(timer);
                isRunning = false;
                isStudyTime = true;
                timeLeft = studyTimeInput.value * 60;
                updateTimerDisplay();
            }
            
            // Add session to history
            function addSessionHistory(text) {
                const sessionItem = document.createElement('div');
                sessionItem.style.padding = '10px';
                sessionItem.style.borderBottom = '1px solid #eee';
                sessionItem.innerHTML = `
                    <div>${text}</div>
                    <div style="font-size: 12px; color: #666;">${new Date().toLocaleString()}</div>
                `;
                
                sessionHistory.prepend(sessionItem);
            }
            
            // Load session history
            function loadSessionHistory() {
                // This would load from saved data in a real app
                sessionHistory.innerHTML = '';
                
                if (data.pomodoro.sessions > 0) {
                    addSessionHistory(`Total sessions: ${data.pomodoro.sessions}`);
                } else {
                    sessionHistory.innerHTML = '<p>No session history yet.</p>';
                }
            }
            
            // Set up event listeners
            startTimerBtn.addEventListener('click', startTimer);
            pauseTimerBtn.addEventListener('click', pauseTimer);
            resetTimerBtn.addEventListener('click', resetTimer);
            
            // Initialize timer display
            timeLeft = studyTimeInput.value * 60;
            updateTimerDisplay();
            loadSessionHistory();
        }

        // Initialize Timetable functionality
        function initTimetable() {
            const data = JSON.parse(localStorage.getItem('studyPlannerData'));
            const timetableGrid = document.getElementById('timetable-grid');
            const saveTimetableBtn = document.getElementById('save-timetable');
            
            // Generate timetable
            function generateTimetable() {
                const tbody = timetableGrid.querySelector('tbody');
                tbody.innerHTML = '';
                
                // Define time slots (8 AM to 5 PM)
                const timeSlots = [];
                for (let hour = 8; hour <= 17; hour++) {
                    timeSlots.push(`${hour}:00 - ${hour + 1}:00`);
                }
                
                // Create rows for each time slot
                timeSlots.forEach(timeSlot => {
                    const row = document.createElement('tr');
                    
                    // Time slot header
                    const timeCell = document.createElement('td');
                    timeCell.textContent = timeSlot;
                    row.appendChild(timeCell);
                    
                    // Create cells for each day
                    for (let i = 0; i < 7; i++) {
                        const cell = document.createElement('td');
                        cell.setAttribute('data-time', timeSlot);
                        cell.setAttribute('data-day', i);
                        
                        // Check if there's a subject for this time and day
                        const cellKey = `${i}-${timeSlot}`;
                        if (data.timetable[cellKey]) {
                            const subject = data.subjects.find(s => s.id === data.timetable[cellKey]);
                            if (subject) {
                                const subjectEl = document.createElement('div');
                                subjectEl.className = 'timetable-subject';
                                subjectEl.style.backgroundColor = subject.color;
                                subjectEl.textContent = subject.name;
                                cell.appendChild(subjectEl);
                            }
                        }
                        
                        // Make cell editable
                        cell.addEventListener('click', function() {
                            openTimetableEditor(this);
                        });
                        
                        row.appendChild(cell);
                    }
                    
                    tbody.appendChild(row);
                });
            }
            
            // Open timetable editor
            function openTimetableEditor(cell) {
                const time = cell.getAttribute('data-time');
                const day = cell.getAttribute('data-day');
                const dayNames = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
                
                // Create a modal for subject selection
                const modal = document.createElement('div');
                modal.className = 'modal active';
                modal.innerHTML = `
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>Edit Timetable - ${dayNames[day]} at ${time}</h3>
                            <button class="close-modal">&times;</button>
                        </div>
                        <div class="form-group">
                            <label>Select Subject</label>
                            <select id="timetable-subject-select">
                                <option value="">-- No Subject --</option>
                                ${data.subjects.map(subject => `<option value="${subject.id}">${subject.name}</option>`).join('')}
                            </select>
                        </div>
                        <div class="form-actions">
                            <button class="btn btn-primary" id="save-timetable-cell">Save</button>
                            <button class="btn btn-primary" id="cancel-timetable-cell">Cancel</button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
                // Set current value if exists
                const cellKey = `${day}-${time}`;
                if (data.timetable[cellKey]) {
                    document.getElementById('timetable-subject-select').value = data.timetable[cellKey];
                }
                
                // Set up event listeners
                modal.querySelector('.close-modal').addEventListener('click', function() {
                    document.body.removeChild(modal);
                });
                
                modal.querySelector('#cancel-timetable-cell').addEventListener('click', function() {
                    document.body.removeChild(modal);
                });
                
                modal.querySelector('#save-timetable-cell').addEventListener('click', function() {
                    const subjectId = document.getElementById('timetable-subject-select').value;
                    const cellKey = `${day}-${time}`;
                    
                    if (subjectId) {
                        data.timetable[cellKey] = parseInt(subjectId);
                    } else {
                        delete data.timetable[cellKey];
                    }
                    
                    localStorage.setItem('studyPlannerData', JSON.stringify(data));
                    generateTimetable();
                    document.body.removeChild(modal);
                    showNotification('Timetable updated successfully!');
                });
            }
            
            // Save timetable
            function saveTimetable() {
                localStorage.setItem('studyPlannerData', JSON.stringify(data));
                showNotification('Timetable saved successfully!');
            }
            
            // Set up event listeners
            saveTimetableBtn.addEventListener('click', saveTimetable);
            
            // Generate initial timetable
            generateTimetable();
        }

        // Initialize Subjects functionality
        function initSubjects() {
            const data = JSON.parse(localStorage.getItem('studyPlannerData'));
            const subjectGrid = document.getElementById('subject-grid');
            const addSubjectBtn = document.getElementById('add-subject');
            const subjectModal = document.getElementById('subject-modal');
            const saveSubjectBtn = document.getElementById('save-subject');
            const cancelSubjectBtn = document.getElementById('cancel-subject');
            const closeModalBtn = document.querySelector('#subject-modal .close-modal');
            
            // Load subjects into the grid
            function loadSubjects() {
                subjectGrid.innerHTML = '';
                
                if (data.subjects.length === 0) {
                    subjectGrid.innerHTML = '<p>No subjects yet. Add a subject to get started!</p>';
                    return;
                }
                
                data.subjects.forEach(subject => {
                    const subjectCard = document.createElement('div');
                    subjectCard.className = 'subject-card';
                    
                    subjectCard.innerHTML = `
                        <div class="subject-color" style="background-color: ${subject.color};"></div>
                        <h3>${subject.name}</h3>
                        <p>Teacher: ${subject.teacher || 'Not specified'}</p>
                        <p>Room: ${subject.room || 'Not specified'}</p>
                        <div class="subject-actions">
                            <button class="edit-subject" data-id="${subject.id}"><i class="fas fa-edit"></i></button>
                            <button class="delete-subject" data-id="${subject.id}"><i class="fas fa-trash"></i></button>
                        </div>
                    `;
                    
                    // Set up event listeners for edit and delete buttons
                    subjectCard.querySelector('.edit-subject').addEventListener('click', function() {
                        openSubjectEditor(subject.id);
                    });
                    
                    subjectCard.querySelector('.delete-subject').addEventListener('click', function() {
                        deleteSubject(subject.id);
                    });
                    
                    subjectGrid.appendChild(subjectCard);
                });
            }
            
            // Open subject editor
            function openSubjectEditor(subjectId = null) {
                const modalTitle = document.getElementById('modal-title');
                const subjectName = document.getElementById('subject-name');
                const subjectColor = document.getElementById('subject-color');
                const subjectTeacher = document.getElementById('subject-teacher');
                const subjectRoom = document.getElementById('subject-room');
                
                if (subjectId) {
                    // Editing existing subject
                    const subject = data.subjects.find(s => s.id === subjectId);
                    if (subject) {
                        modalTitle.textContent = 'Edit Subject';
                        subjectName.value = subject.name;
                        subjectColor.value = subject.color;
                        subjectTeacher.value = subject.teacher || '';
                        subjectRoom.value = subject.room || '';
                        
                        // Set current subject ID as data attribute
                        saveSubjectBtn.setAttribute('data-id', subjectId);
                    }
                } else {
                    // Adding new subject
                    modalTitle.textContent = 'Add New Subject';
                    subjectName.value = '';
                    subjectColor.value = '#4285f4';
                    subjectTeacher.value = '';
                    subjectRoom.value = '';
                    
                    // Remove data attribute if exists
                    saveSubjectBtn.removeAttribute('data-id');
                }
                
                // Show modal
                subjectModal.classList.add('active');
            }
            
            // Save subject
            function saveSubject() {
                const subjectId = saveSubjectBtn.getAttribute('data-id');
                const subjectName = document.getElementById('subject-name').value;
                const subjectColor = document.getElementById('subject-color').value;
                const subjectTeacher = document.getElementById('subject-teacher').value;
                const subjectRoom = document.getElementById('subject-room').value;
                
                if (!subjectName) {
                    showNotification('Please enter a subject name', 'error');
                    return;
                }
                
                if (subjectId) {
                    // Update existing subject
                    const subjectIndex = data.subjects.findIndex(s => s.id === parseInt(subjectId));
                    if (subjectIndex !== -1) {
                        data.subjects[subjectIndex].name = subjectName;
                        data.subjects[subjectIndex].color = subjectColor;
                        data.subjects[subjectIndex].teacher = subjectTeacher;
                        data.subjects[subjectIndex].room = subjectRoom;
                    }
                } else {
                    // Add new subject
                    const newId = data.subjects.length > 0 ? Math.max(...data.subjects.map(s => s.id)) + 1 : 1;
                    
                    data.subjects.push({
                        id: newId,
                        name: subjectName,
                        color: subjectColor,
                        teacher: subjectTeacher,
                        room: subjectRoom
                    });
                }
                
                localStorage.setItem('studyPlannerData', JSON.stringify(data));
                loadSubjects();
                subjectModal.classList.remove('active');
                showNotification('Subject saved successfully!');
            }
            
            // Delete subject
            function deleteSubject(subjectId) {
                if (confirm('Are you sure you want to delete this subject?')) {
                    data.subjects = data.subjects.filter(s => s.id !== subjectId);
                    
                    // Also remove from timetable
                    for (const key in data.timetable) {
                        if (data.timetable[key] === subjectId) {
                            delete data.timetable[key];
                        }
                    }
                    
                    localStorage.setItem('studyPlannerData', JSON.stringify(data));
                    loadSubjects();
                    // Regenerate timetable if it's visible
                    if (document.getElementById('timetable').classList.contains('active')) {
                        initTimetable();
                    }
                    showNotification('Subject deleted successfully!');
                }
            }
            
            // Set up event listeners
            addSubjectBtn.addEventListener('click', function() {
                openSubjectEditor();
            });
            
            saveSubjectBtn.addEventListener('click', saveSubject);
            cancelSubjectBtn.addEventListener('click', function() {
                subjectModal.classList.remove('active');
            });
            closeModalBtn.addEventListener('click', function() {
                subjectModal.classList.remove('active');
            });
            
            // Load subjects on initialization
            loadSubjects();
        }

        // Initialize Resources functionality
        function initResources() {
            const data = JSON.parse(localStorage.getItem('studyPlannerData'));
            const resourcesGrid = document.getElementById('resources-grid');
            const addResourceBtn = document.getElementById('add-resource');
            const resourceModal = document.getElementById('resource-modal');
            const saveResourceBtn = document.getElementById('save-resource');
            const cancelResourceBtn = document.getElementById('cancel-resource');
            const closeResourceModalBtn = resourceModal.querySelector('.close-modal');
            const resourceTypeSelect = document.getElementById('resource-type');
            const resourceUrlGroup = document.getElementById('resource-url-group');
            const resourceFileGroup = document.getElementById('resource-file-group');
            
            // Load resources into the grid
            function loadResources() {
                resourcesGrid.innerHTML = '';
                
                if (data.resources.length === 0) {
                    resourcesGrid.innerHTML = '<p>No resources yet. Add a resource to get started!</p>';
                    return;
                }
                
                data.resources.forEach(resource => {
                    const resourceCard = document.createElement('div');
                    resourceCard.className = 'resource-card';
                    
                    let iconClass = 'fas fa-file';
                    if (resource.type === 'pdf') iconClass = 'fas fa-file-pdf';
                    else if (resource.type === 'link') iconClass = 'fas fa-link';
                    else if (resource.type === 'document') iconClass = 'fas fa-file-word';
                    
                    resourceCard.innerHTML = `
                        <div class="resource-icon">
                            <i class="${iconClass}"></i>
                        </div>
                        <h3>${resource.title}</h3>
                        <p>${resource.description || 'No description'}</p>
                        <div class="resource-actions">
                            <button class="view-resource" data-id="${resource.id}"><i class="fas fa-eye"></i></button>
                            <button class="delete-resource" data-id="${resource.id}"><i class="fas fa-trash"></i></button>
                        </div>
                    `;
                    
                    // Set up event listeners for view and delete buttons
                    resourceCard.querySelector('.view-resource').addEventListener('click', function() {
                        viewResource(resource.id);
                    });
                    
                    resourceCard.querySelector('.delete-resource').addEventListener('click', function() {
                        deleteResource(resource.id);
                    });
                    
                    resourcesGrid.appendChild(resourceCard);
                });
            }
            
            // Open resource editor
            function openResourceEditor(resourceId = null) {
                const modalTitle = document.getElementById('resource-modal-title');
                const resourceTitle = document.getElementById('resource-title');
                const resourceUrl = document.getElementById('resource-url');
                const resourceDescription = document.getElementById('resource-description');
                const resourceSubject = document.getElementById('resource-subject');
                
                // Populate subjects dropdown
                resourceSubject.innerHTML = '<option value="">No Subject</option>';
                data.subjects.forEach(subject => {
                    resourceSubject.innerHTML += `<option value="${subject.id}">${subject.name}</option>`;
                });
                
                if (resourceId) {
                    // Editing existing resource
                    const resource = data.resources.find(r => r.id === resourceId);
                    if (resource) {
                        modalTitle.textContent = 'Edit Resource';
                        resourceTitle.value = resource.title;
                        resourceUrl.value = resource.url || '';
                        resourceDescription.value = resource.description || '';
                        resourceSubject.value = resource.subjectId || '';
                        resourceTypeSelect.value = resource.type;
                        
                        // Set current resource ID as data attribute
                        saveResourceBtn.setAttribute('data-id', resourceId);
                    }
                } else {
                    // Adding new resource
                    modalTitle.textContent = 'Add New Resource';
                    resourceTitle.value = '';
                    resourceUrl.value = '';
                    resourceDescription.value = '';
                    resourceSubject.value = '';
                    resourceTypeSelect.value = 'pdf';
                    
                    // Remove data attribute if exists
                    saveResourceBtn.removeAttribute('data-id');
                }
                
                // Show modal
                resourceModal.classList.add('active');
            }
            
            // Handle resource type change
            resourceTypeSelect.addEventListener('change', function() {
                if (this.value === 'link') {
                    resourceUrlGroup.style.display = 'block';
                    resourceFileGroup.style.display = 'none';
                } else {
                    resourceUrlGroup.style.display = 'block';
                    resourceFileGroup.style.display = 'none';
                }
            });
            
            // Save resource
            function saveResource() {
                const resourceId = saveResourceBtn.getAttribute('data-id');
                const resourceTitle = document.getElementById('resource-title').value;
                const resourceUrl = document.getElementById('resource-url').value;
                const resourceDescription = document.getElementById('resource-description').value;
                const resourceSubject = document.getElementById('resource-subject').value;
                const resourceType = document.getElementById('resource-type').value;
                
                if (!resourceTitle) {
                    showNotification('Please enter a resource title', 'error');
                    return;
                }
                
                if (resourceId) {
                    // Update existing resource
                    const resourceIndex = data.resources.findIndex(r => r.id === parseInt(resourceId));
                    if (resourceIndex !== -1) {
                        data.resources[resourceIndex].title = resourceTitle;
                        data.resources[resourceIndex].url = resourceUrl;
                        data.resources[resourceIndex].description = resourceDescription;
                        data.resources[resourceIndex].subjectId = resourceSubject;
                        data.resources[resourceIndex].type = resourceType;
                    }
                } else {
                    // Add new resource
                    const newId = data.resources.length > 0 ? Math.max(...data.resources.map(r => r.id)) + 1 : 1;
                    
                    data.resources.push({
                        id: newId,
                        title: resourceTitle,
                        url: resourceUrl,
                        description: resourceDescription,
                        subjectId: resourceSubject,
                        type: resourceType,
                        createdAt: new Date().toISOString()
                    });
                }
                
                localStorage.setItem('studyPlannerData', JSON.stringify(data));
                loadResources();
                resourceModal.classList.remove('active');
                showNotification('Resource saved successfully!');
            }
            
            // View resource
            function viewResource(resourceId) {
                const resource = data.resources.find(r => r.id === resourceId);
                if (resource) {
                    if (resource.type === 'link') {
                        window.open(resource.url, '_blank');
                    } else {
                        showNotification('This resource type cannot be viewed directly', 'info');
                    }
                }
            }
            
            // Delete resource
            function deleteResource(resourceId) {
                if (confirm('Are you sure you want to delete this resource?')) {
                    data.resources = data.resources.filter(r => r.id !== resourceId);
                    
                    localStorage.setItem('studyPlannerData', JSON.stringify(data));
                    loadResources();
                    showNotification('Resource deleted successfully!');
                }
            }
            
            // Set up event listeners
            addResourceBtn.addEventListener('click', function() {
                openResourceEditor();
            });
            
            saveResourceBtn.addEventListener('click', saveResource);
            cancelResourceBtn.addEventListener('click', function() {
                resourceModal.classList.remove('active');
            });
            closeResourceModalBtn.addEventListener('click', function() {
                resourceModal.classList.remove('active');
            });
            
            // Load resources on initialization
            loadResources();
        }

        // Initialize Progress functionality
        function initProgress() {
            const data = JSON.parse(localStorage.getItem('studyPlannerData'));
            const progressChart = document.getElementById('progress-chart');
            const subjectChart = document.getElementById('subject-chart');
            const studyStatistics = document.getElementById('study-statistics');
            
            // Load progress data
            function loadProgress() {
                // Calculate study statistics
                const totalStudyTime = data.pomodoro.totalTime;
                const totalSessions = data.pomodoro.sessions;
                const completedTasks = data.tasks.filter(task => task.completed).length;
                const totalTasks = data.tasks.length;
                const taskCompletionRate = totalTasks > 0 ? (completedTasks / totalTasks) * 100 : 0;
                
                // Update study statistics
                studyStatistics.innerHTML = `
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 15px;">
                        <div style="padding: 15px; background-color: #f5f5f5; border-radius: 8px;">
                            <div style="font-size: 24px; font-weight: bold; color: var(--accent);">${Math.floor(totalStudyTime / 60)}h ${totalStudyTime % 60}m</div>
                            <div style="font-size: 14px; color: var(--text-light);">Total Study Time</div>
                        </div>
                        <div style="padding: 15px; background-color: #f5f5f5; border-radius: 8px;">
                            <div style="font-size: 24px; font-weight: bold; color: var(--accent);">${totalSessions}</div>
                            <div style="font-size: 14px; color: var(--text-light);">Pomodoro Sessions</div>
                        </div>
                        <div style="padding: 15px; background-color: #f5f5f5; border-radius: 8px;">
                            <div style="font-size: 24px; font-weight: bold; color: var(--accent);">${completedTasks}/${totalTasks}</div>
                            <div style="font-size: 14px; color: var(--text-light);">Tasks Completed</div>
                        </div>
                        <div style="padding: 15px; background-color: #f5f5f5; border-radius: 8px;">
                            <div style="font-size: 24px; font-weight: bold; color: var(--accent);">${taskCompletionRate.toFixed(1)}%</div>
                            <div style="font-size: 14px; color: var(--text-light);">Completion Rate</div>
                        </div>
                    </div>
                `;
                
                // Create study progress chart
                const progressCtx = progressChart.getContext('2d');
                new Chart(progressCtx, {
                    type: 'line',
                    data: {
                        labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                        datasets: [{
                            label: 'Study Time (minutes)',
                            data: [120, 90, 180, 150, 200, 60, 0],
                            borderColor: '#4285f4',
                            tension: 0.1,
                            fill: false
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Weekly Study Progress'
                            }
                        }
                    }
                });
                
                // Create subject progress chart
                const subjectCtx = subjectChart.getContext('2d');
                
                // Calculate subject-wise study time (for demo purposes)
                const subjectData = {};
                data.subjects.forEach(subject => {
                    subjectData[subject.name] = Math.floor(Math.random() * 300) + 60; // Random data for demo
                });
                
                new Chart(subjectCtx, {
                    type: 'bar',
                    data: {
                        labels: Object.keys(subjectData),
                        datasets: [{
                            label: 'Study Time (minutes)',
                            data: Object.values(subjectData),
                            backgroundColor: Object.keys(subjectData).map((_, i) => {
                                const colors = ['#4285f4', '#34a853', '#fbbc04', '#ea4335', '#9b59b6'];
                                return colors[i % colors.length];
                            })
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Subject-wise Study Time'
                            }
                        }
                    }
                });
            }
            
            // Load progress on initialization
            loadProgress();
        }

        // Initialize Backup functionality
        function initBackup() {
            const createBackupBtn = document.getElementById('create-backup');
            const restoreBackupBtn = document.getElementById('restore-backup');
            const cloudSyncBtn = document.getElementById('cloud-sync');
            const backupFileInput = document.getElementById('backup-file');
            const backupList = document.getElementById('backup-list');
            
            // Create backup
            function createBackup() {
                const data = JSON.parse(localStorage.getItem('studyPlannerData'));
                const backupData = JSON.stringify(data);
                const blob = new Blob([backupData], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `study-planner-backup-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showNotification('Backup created successfully!');
            }
            
            // Restore backup
            function restoreBackup() {
                backupFileInput.click();
            }
            
            // Handle backup file selection
            function handleBackupFileSelect(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const backupData = JSON.parse(e.target.result);
                        
                        // Validate backup data structure
                        if (backupData.notes && backupData.tasks && backupData.events) {
                            localStorage.setItem('studyPlannerData', JSON.stringify(backupData));
                            showNotification('Backup restored successfully!');
                            
                            // Reload the page to apply changes
                            setTimeout(() => {
                                location.reload();
                            }, 1500);
                        } else {
                            showNotification('Invalid backup file', 'error');
                        }
                    } catch (error) {
                        showNotification('Error reading backup file', 'error');
                        console.error(error);
                    }
                };
                reader.readAsText(file);
                
                // Reset file input
                e.target.value = '';
            }
            
            // Cloud sync (placeholder)
            function cloudSync() {
                showNotification('Cloud sync feature coming soon!', 'warning');
            }
            
            // Load backup list
            function loadBackupList() {
                // This would load from a list of backups in a real app
                backupList.innerHTML = '<p>No backups found</p>';
            }
            
            // Set up event listeners
            createBackupBtn.addEventListener('click', createBackup);
            restoreBackupBtn.addEventListener('click', restoreBackup);
            cloudSyncBtn.addEventListener('click', cloudSync);
            backupFileInput.addEventListener('change', handleBackupFileSelect);
            
            // Load backup list on initialization
            loadBackupList();
        }
    </script>
</body>
</html>
